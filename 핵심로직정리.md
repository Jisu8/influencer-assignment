# 인플루언서 배정 시스템 핵심 로직 정리

## 📋 **1. 기본 구조**

### **데이터 파일**
- `data/influencer.csv`: 기본 인플루언서 정보 (ID, 이름, 팔로워, 계약수 등)
- `data/assignment_history.csv`: 배정 이력 (ID, 브랜드, 배정월, 결과, 집행URL)
- `data/execution_status.csv`: 집행 결과 (ID, 브랜드, 배정월, 실제집행수)

### **환경 구분**
- **로컬**: 데이터만 로컬 저장
- **Streamlit Cloud**: 데이터 저장 + GitHub API로 자동 동기화

---

## 🔄 **2. 공통 핵심 로직**

### **전제 조건**
```
이전 달 모든 배정이 집행완료되어야 다음 달 배정 가능
```

### **잔여수 계산**
```
실제 잔여수 = 계약수 - (집행완료 수 + 배정완료 수)
```

### **공통 배정 조건**
- ✅ 계약수 > 0
- ✅ 잔여수 > 0  
- ✅ 이전 달 집행완료 상태

---

## 🎯 **3. 배정 방식별 차이점**

### **자동배정**
- **사용 목적**: 브랜드별 목표수에 따른 배정 자동화 및 효율화
- **배정 방식**: 계약수 많은 순 → 랜덤
- **다중 브랜드**: 같은 인플루언서 같은 달에 서로 다른 브랜드 배정 불가

### **수동배정**
- **사용 목적**: 사용자가 원하는 특정 인플루언서 배정을 앱 내에서 손쉽게 추가
- **배정 방식**: 사용자가 인플루언서 ID 선택하여 수동 배정
- **다중 브랜드**: 같은 달에 서로 다른 브랜드 배정 가능 (유연성)

### **엑셀업로드**
- **사용 목적**: 대량으로 배정결과 / 집행결과 업데이트 가능, 특히 월 종료 후 집행 결과 업데이트 하기에 용이
- **배정 방식**:
  - 엑셀 데이터 업로드
  - ID, 배정월, 브랜드, 상태값(배정완료/집행완료) 업데이트하면, ID 기반 추가 정보 자동 인식
- **다중 브랜드**: 같은 달에 서로 다른 브랜드 배정 가능 (유연성)

---

## 🖥️ **4. 시스템 UI 구성**

### **⚙️ 배정 탭 (사이드바)**
**"새로운 배정을 실행하는 곳"**
- **자동 배정**
- **수동 배정**

### **📊 배정현황 탭**
**"배정 현황을 확인하고 관리하는 곳"**
- **필터 조회**: 월별, 브랜드별로 누가 어떤 캠페인에 배정되었는지 확인
- **엑셀 다운로드**: 엑셀로 현재 배정 및 결과 다운로드

### **👥 인플루언서별 탭**
**"인플루언서 별 정보를 한번에 확인하는 곳"**
- **전체 인플루언서 집행 현황**: 전체 인플루언서 정보 및 브랜드별 계약수 확인, 월별 전체 브랜드 집행 현황 확인
- **필터 조회**: 브랜드 별로 필터 클릭 시 계약수가 >0인 인플루언서만 보여짐, 월별 집행 현황 확인
- **엑셀 다운로드**: 엑셀로 인플루언서별 결과 다운로드

---

## 🔗 **5. GitHub 동기화**

### **Cloud → GitHub**
- Streamlit Cloud에서 데이터 변경 시 GitHub API로 직접 업데이트
- 파일 내용을 Base64로 인코딩하여 GitHub에 커밋

### **로컬 → GitHub**
- `git push` 시 원격 변경사항 자동 병합 후 푸시
- 충돌 시 강제 리셋 후 푸시

---

## 🎨 **6. UI/UX 로직**

### **탭 상태 유지**
- `st.session_state.current_tab`으로 새로고침 시에도 탭 유지

### **체크박스 기능**
- "전체 선택" 버튼으로 일괄 선택/해제
- 동적 키와 세션 상태로 안정적 동작

### **알림 시스템**
- 성공/경고 메시지 3초간 표시
- GitHub 관련 알림 최소화

---

## ⚡ **7. 성능 최적화**

### **데이터 처리**
- 벡터화된 Pandas 연산 사용
- 불필요한 데이터 재생성 방지
- 부분 업데이트로 성능 향상

### **메모리 효율**
- 필요한 데이터만 로드
- 임시 변수 최소화

---

## 📈 **8. 핵심 비즈니스 로직**

### **배정 원칙**
1. **공정성**: 계약수 기반 우선순위 (자동배정)
2. **효율성**: 잔여수 기반 배정
3. **연속성**: 이전 달 완료 후 다음 달 배정
4. **유연성**: 수동 배정 및 엑셀 업로드 지원

### **데이터 일관성**
- 모든 계산에서 집행완료 + 배정완료 고려
- 브랜드별/전체별 잔여수 정확한 계산
- 실시간 데이터 동기화

---

## 🚀 **9. 시스템 특징 요약**

### **핵심 강점**
1. **계약수 기반 공정한 배정**: 자동배정에서 계약수 많은 순 우선
2. **다양한 배정 방식**: 자동(효율성) / 수동(유연성) / 엑셀(대량처리)
3. **실시간 데이터 동기화**: Cloud ↔ GitHub 자동 연동
4. **유연한 다중 브랜드 정책**: 배정 방식별 차별화
5. **정확한 잔여수 계산**: 집행완료 + 배정완료 모두 고려

### **비즈니스 가치**
- **효율성**: 자동 배정으로 업무 자동화
- **유연성**: 수동/엑셀 배정으로 특수 상황 대응
- **투명성**: 실시간 데이터 동기화로 데이터 신뢰성 확보
- **확장성**: 다양한 배정 정책으로 비즈니스 요구사항 충족

이 시스템은 **공통된 핵심 로직**을 기반으로 **배정 방식별 차별화된 정책**을 제공하는 완전 자동화된 인플루언서 관리 시스템입니다! 🎯
